"""
Telegram Bot –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥
"""
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, WebAppInfo
from telegram.ext import Application, CommandHandler, ContextTypes
from app.core.config import settings


async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    # URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –∏–ª–∏ –∏–∑ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    app_url = settings.APP_URL or "https://rightfully-integral-whitebait.cloudpub.ru"
    
    # –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    message_text = (
        "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Sparks ‚Äî –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º –æ–≥–Ω—è üî•\n\n"
        "–í–Ω—É—Ç—Ä–∏ –≤–∞—Å –∂–¥—ë—Ç:\n\n"
        "‚ö°Ô∏è –ö–æ—Ä–æ—Ç–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –ø—Ä–æ—Å—Ç—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø—Ä–æ—è–≤–ª—è–µ—Ç–µ –∑–∞–±–æ—Ç—É –∏ –≤–Ω–∏–º–∞–Ω–∏–µ –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É.\n\n"
        "‚ö°Ô∏è –ò–¥–µ–∏ —Ç—ë–ø–ª—ã—Ö —Å–≤–∏–¥–∞–Ω–∏–π –∏ –≤—Ä–µ–º–µ–Ω–∏ –≤–º–µ—Å—Ç–µ ‚Äî —á—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–∞—Ç—å –≤ \"—á—Ç–æ –¥–µ–ª–∞–µ–º?\" –∏ —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –ø—Ä–∏—è—Ç–Ω–æ–º—É.\n\n"
        "‚ö°Ô∏è –ñ–∏–≤—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –æ —á—É–≤—Å—Ç–≤–∞—Ö –∏ –∂–µ–ª–∞–Ω–∏—è—Ö ‚Äî —á–µ—Ä–µ–∑ –Ω–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏ –≥–æ—Ç–æ–≤—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏, –±–µ–∑ –Ω–µ–ª–æ–≤–∫–∏—Ö —Å–µ—Ä—å–µ–∑–Ω—ã—Ö \"–Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å\".\n\n"
        "‚ö°Ô∏è –ò–≥—Ä—ã –¥–ª—è –¥–≤–æ–∏—Ö ‚Äî –ª–µ–≥–∫–∏–π —Å–ø–æ—Å–æ–± —É–∑–Ω–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –±–ª–∏–∂–µ, –ø–æ—Å–º–µ—è—Ç—å—Å—è –∏ —É–≤–∏–¥–µ—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Å –Ω–æ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω—ã.\n\n"
        "‚ö°Ô∏è \"–ò—Å–∫—Ä—ã\" –º–µ–∂–¥—É –≤–∞–º–∏ ‚Äî –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ, –∫–∞–∫ –∫–∞–∂–¥—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π —à–∞–≥ –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ç–µ–ø–ª–æ–µ –æ—â—É—â–µ–Ω–∏–µ \"–º—ã\".\n\n"
        "–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å:\n\n"
        "–ù–∞–∂–º–∏—Ç–µ ¬´–ù–∞—á–∞—Ç—å¬ª, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –≤–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –ø–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–π –ø–∞—Ä—ã ‚Äî –ø—É—Å—Ç—å —É–∂–µ —Å–µ–≥–æ–¥–Ω—è –º–µ–∂–¥—É –≤–∞–º–∏ —Å—Ç–∞–Ω–µ—Ç —á—É—Ç—å –±–æ–ª—å—à–µ –∏—Å–∫—Ä—ã ‚ú®"
    )
    
    # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebApp
    keyboard = [
        [InlineKeyboardButton(
            "–ù–∞—á–∞—Ç—å",
            web_app=WebAppInfo(url=app_url)
        )]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(
        message_text,
        reply_markup=reply_markup
    )


def setup_bot():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
    if not settings.TELEGRAM_BOT_TOKEN:
        print("‚ö†Ô∏è TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –±–æ—Ç –Ω–µ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω")
        return None
    
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ—Ç–∞
    application = Application.builder().token(settings.TELEGRAM_BOT_TOKEN).build()
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
    application.add_handler(CommandHandler("start", start_command))
    
    return application


async def run_bot():
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
    application = setup_bot()
    if application:
        print("ü§ñ Telegram –±–æ—Ç –∑–∞–ø—É—â–µ–Ω")
        await application.initialize()
        await application.start()
        await application.updater.start_polling()
    else:
        print("‚ö†Ô∏è Telegram –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω (–Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞)")


if __name__ == "__main__":
    import asyncio
    asyncio.run(run_bot())

